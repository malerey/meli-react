<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: services/userService.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: services/userService.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 *  @fileOverview Services for getting, creating, updating and deleting user data 
 *  @author       Maria Elena Rey
 *  @module       userService
 *  @requires     fs
*/

const self = {}
const fs = require('fs');
self.filePath = __dirname + '/../commons/users.json';

/**
 * Reads and parses JSON file containing current user list
 * @module getUsers
 * @function
 * @returns {Object} List of all users
*/

self.getUsers = () => new Promise((accept, reject) => {
  fs.readFile(self.filePath, (err, data) => {
    if (err) return reject(err);
    accept(JSON.parse(data));
  });
});

/**
 * Takes a new user and adds it to JSON file
 * @module addUser
 * @function
 * @param {Object} user - Object containing new user information
 * @returns {Oject} Updated list of users
*/

self.addUser = (user) => new Promise((accept, reject) => {
  fs.readFile(self.filePath, (err, data) => {
    if (err) return reject(err);
    accept(JSON.parse(data));
    const usersAdded = JSON.parse(data)
    usersAdded.content.push(user)
    fs.writeFile(self.filePath, JSON.stringify(usersAdded), err => {
      if (err) return reject(err);
      accept('Success');
    });
  })
});

/**
 * Removes user from JSON file 
 * @module removeUser
 * @function
 * @param {string} id - Index of user to remove in rendered list and JSON file 
 * @returns {Object} Updated list of users
*/

self.removeUser = (id) => new Promise((accept, reject) => {
  fs.readFile(self.filePath, (err, data) => {
    if (err) return reject(err);
    const usersToRemove = JSON.parse(data)
    const filteredUsers = usersToRemove.content.filter((u, i) => i != id);
    const newUsers = { content: filteredUsers }
    accept(JSON.stringify(newUsers));
    fs.writeFile(self.filePath, JSON.stringify(newUsers), err => {
      if (err) return reject(err);
      accept('Success');
    });
  })
});

/**
 * Edits user in JSON file 
 * @module editUser
 * @function
 * @param {string} id - Index of user to edit in rendered list and JSON file 
 * @param {Object} body - Object with new user data 
 * @returns {Object} Updated list of users
*/

self.editUser = (id, body) => new Promise((accept, reject) => {
  fs.readFile(self.filePath, (err, data) => {
    if (err) return reject(err);
    const usersToEdit = JSON.parse(data)
    usersToEdit.content[id].name = body.name
    usersToEdit.content[id].lastname = body.lastname
    usersToEdit.content[id].phone = body.phone
    usersToEdit.content[id].email = body.email
    const newUsers = usersToEdit
    accept(JSON.stringify(newUsers));
    fs.writeFile(self.filePath, JSON.stringify(newUsers), err => {
      if (err) return reject(err);
      accept('Success');
    });
  })
});

module.exports = self</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Ping%2520router.html">Ping router</a></li><li><a href="module-User%2520router.html">User router</a></li><li><a href="module-userController.html">userController</a></li><li><a href="module-userService.html">userService</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.2</a> on Thu May 30 2019 13:15:24 GMT-0300 (-03)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
